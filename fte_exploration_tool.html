<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="d3.v3.min.js"></script>
	<style>
	.hover {
		font-family: "Courier New";
		font-style: italic;
		font-size: 10px;
	}

	.axis path,
	.axis line {
		fill: none;
		stroke: black;
		shape-rendering: crispEdges;
	}

	.axis text {
		font-family: sans-serif;
		font-size: 11px;
	}

	.navBar {
		font-family: sans-serif;
		font-size: 12px;
		cursor: pointer;
	}

	.dyn-axis path,
	.dyn-axis line {
		fill: none;
		stroke: black;
		shape-rendering: crispEdges;
	}

	.dyn-axis2 path,
	.dyn-axis2 line {
		fill: none;
		stroke: black;
		shape-rendering: crispEdges;
	}

	.dyn-axis text {
		font-family: sans-serif;
		font-size: 11px;
	}

	.dyn-axis2 text {
		font-family: sans-serif;
		font-size: 11px;
	}
	h2 {
		text-align: center;
		letter-spacing: 3px;
		font-size: 22px;
		font-weight: bold;
		text-transform: uppercase;
		font-family: sans-serif;
	}
	h3 {
		text-align: center;
		font-family: sans-serif;
		font-style: italic;
		font-size: 12px;
	}
	.sideTitleText {
		font-size: 18px;
		letter-spacing: 2px;
		font-weight: bold;
		text-transform: uppercase;
		font-family: sans-serif;
	}
	.subtitleText {
		font-family: sans-serif;
		font-weight: bold;
		font-size: 12px;
	}
	.sideSubtitleText{
		font-family: sans-serif;
		font-size: 11px;
	}
	.sortBy {
		font-size: 10px;
		font-style: italic;
		font-family: sans-serif;
		cursor: pointer;
	}
	.viewAll {
		font-size: 14px;
		font-style: italic;
		font-family: sans-serif;
		cursor: pointer;
	}
	.dyn-sortBy {
		font-size: 10px;
		font-style: italic;
		font-family: sans-serif;
		cursor: pointer;
	}
	.barText {
		font-size: 10px;
		font-family: sans-serif;
		fill: black;
	}
	.fteText {
		font-size:9px;
		font-family: sans-serif;
		font-style: italic;
	}
	.navSVG {
		border-bottom: 1px solid black;
		border-top: 1px solid black;
	}
	.buttons div {
        padding: 3px;
        padding-left: 10px;
        padding-right: 10px;
        margin-top:1px;
        margin-right: 1px;
        margin-left: 1px;
        float: left;
        display: inline-block;
        white-space: nowrap;
        cursor: pointer;
        font-family: sans-serif;
        font-size: 11px;
        font-weight: bold;
        color: white;
	}
	.prog_buttons {
        position: absolute;
        top: 130px;
        left: 50px;
	}
	.loc_buttons {
        position: absolute;
        top: 110px;
        left: 50px;
	}
	.student_buttons {
		position: absolute;
		top: 150px;
		left: 50px;
	}
	.years_buttons {
		position: absolute;
		top: 90px;
		left: 50px;
	}
	.selectAll_buttons {
		position: absolute;
		top: 142px;
		left: 1100px;
	}
	.selectAll_buttons div {
		font-size: 16px;
	}

	</style>

	<script type="text/javascript">
	function graph(fteData){


		"use strict";
		var margin=75,
			width=750 - margin,
			height=450 - margin,
			width2=800,
			navHeight=80;

		d3.select('body')
			.append('h2')
			.text('FTE Exploration Tool');

		d3.select('body')
			.append('h3')
			.text('Click on any bar to the left to display detailed statistics; use the filters on the top to narrow your search')

		var topNavigationSVG = d3.select('body')
			.append('svg')
			.attr('width', width+margin+width2)
			.attr('height', navHeight)
			.attr('class', 'navSVG')
			.append('g')
			.attr('class', 'topNav')

		var svg1=d3.select('body')
			.append('svg')
			.attr('width', width+margin)
			.attr('height', height+margin)
			.append('g')
			.attr('class', 'top_graph');

		var svg2=d3.select('body')
			.append('svg')
			.attr('width', width2)
			.attr('height', height+margin)
			.append('g')
			.attr('class', 'side_graph')

		var filterAllBoolean=true;

		var barspacing= 9

		var barwidth=8

		var padding = 40;

		var yAxisPadding=padding-5;

		//first graph for this year only

		

		var textspacing=2

		var yearGraph_xaxis=300

		var yearGraph_topPadding=75

		var distribution_width=300

		var fte_spacing=300

		var distribution_offset=250

		var xaxisDeltaGraph=400

		var deltaHeight=150

		var sortTextOffset = 175
			
		var sortTextSpacing = 75


		//boolean for location filtering
		var locFilterBoolean=false;
		var locClick='all';

		var progFilterBoolean=false;
		var clusterClick='all'

		var studentFilterBoolean=false;
		var studentClick='all'

		var yearClick='2016-17'

		function mouse_hover(data, index, xaxis, text, value){
									svg1.append('text')
								   			.attr('class', 'hover')
								   			.text(text.substring(0, 12) + ': ' + Math.round(value*100)/100)
								   			.attr('x', (index * barspacing) + textspacing*4.5 + padding)
								   			.attr('y', xaxis + 20)
								   			.attr('fill', 'white')
								   			.transition()
								   			.delay(200)
								   			.duration(300)
								   			.attr('fill', 'black')
								   		svg1.append("line")
								   			.attr('class', 'hover')
								   			.style('stroke-dasharray', ('3, 3'))
								   			.attr('x1', index * barspacing + textspacing + padding)
								   			.attr('y1', xaxis + 10)
								   			.attr('x2', index * barspacing + textspacing + padding)
								   			.attr('y2', xaxis + 10)
								   			.transition()
								   			.duration(200)
								   			.attr('x2', (index * barspacing) + textspacing + padding)
								   			.attr('y2', xaxis + 25)
								   			.attr('stroke-width', 1)
								   			.attr('stroke', 'black')

								   		svg1.append('line')
								   			.attr('class', 'hover')
								   			.style('stroke-dasharray', ('3, 3'))
								   			.attr('x1', (index * barspacing) + textspacing  + padding)
								   			.attr('y1', xaxis + 25)
								   			.attr('x2', (index * barspacing) + textspacing *4 + padding)
								   			.attr('y2', xaxis + 25)
								   			.transition()
								   			.delay(200)
								   			.duration(200)
								   			.attr('x2', (index * barspacing) + textspacing *15 + padding)
								   			.attr('y2', xaxis + 25)
								   			.attr('stroke-width', 1)
								   			.attr('stroke', 'black')
								}






		function mouse_out(){
											d3.selectAll('.hover')
												.transition()
												.duration(300)
												.attr('opacity', 0)
												.remove()
		}




		function current_year (fteData){
											d3.selectAll('.currentYear').remove()

											var locFiltered=fteData.filter(function(d){
												return locFilterBoolean? 
													//true
													d['location']==locClick:
													//false
													true;
											})

											var progFiltered=locFiltered.filter(function(d){
												return progFilterBoolean?
													//true
													d['cluster']==clusterClick:
													//false
													true;
											})

											var studentFiltered=progFiltered.filter(function(d){
												return studentFilterBoolean?
													//true
													d['studentType']==studentClick:
													//false
													true;
											}) 


											var currentYear=studentFiltered.filter(function(d){
												return d['year']==yearClick
											})

										

											var currentNested=d3.nest()
														.key(function(d){
															return d['programTitle'];
														})
														.rollup(function(leaves){
															var fte=d3.sum(leaves, function(d){
																return +d['sumFTE'];
															});
															return {
																'fte': fte,
															}
														})
														.entries(currentYear)

											var maxFTEs = d3.max(currentNested, function(d){
												return d.values['fte'];
											})

											if (maxFTEs==undefined | maxFTEs==0){
												svg1.append('text')
													.attr('x', width/3)
													.attr('y', 200)
													.attr('font-style', 'italic')
													.text('You have selected an empty dataset. Please make another selection')
													.attr('class', 'currentYear')

												return false
											}

											barwidth =
												(width-300)/currentNested.length>=20?
												20:
												(width-300)/currentNested.length


											barspacing = barwidth + 1


											var xaxisGraphOne = 200

											var bar1Scale = d3.scale.linear()
																.domain([0, maxFTEs])
																.range([0, xaxisGraphOne])

											var AxisScale = d3.scale.linear()
																.domain([maxFTEs, 0])
																.range([0, xaxisGraphOne])

											var yAxis1 = d3.svg.axis().scale(AxisScale).orient('left')

											var sortOrder=true;

											var datasetSort = currentNested.sort(function(a, b){return b.values['fte'] - a.values['fte'];})
												
											svg1.append('text')
												.text('Total FTE values, ' + yearClick)
												.attr('x', width/3)
												.attr('y', 20)
												.attr('class', 'subtitleText currentYear')

											

											svg1.append('text')
												.text('|')
												.attr('x', width/3 + sortTextOffset + sortTextSpacing - 5)
												.attr('y', 20)
												.attr('class', 'sortBy currentYear')

											var alphaClicked=false;

											svg1.append('text')
												.text('Alphabetical')
												.attr('x', width/3 + sortTextOffset)
												.attr('y', 20)
												.attr('class', 'sortBy currentYear')
												.on('mouseover', function(d){
													d3.select(this).attr('font-weight', 'bold')
												})
												.on('mouseout', function(d){

													d3.select(this).attr('font-weight', function(){
														return alphaClicked? 'bold': 'normal';
													})
												})
												.on('click', function(){
													alphaClicked=true;

													d3.selectAll('.sortBy').attr('font-weight', 'normal')

													d3.select(this).attr('font-weight', 'bold')

													svg1.selectAll('.currentTotal')
														.sort(function(a, b){
															return d3.ascending(a['key'], b['key']);
														})
														.on('mouseover', function(d, i){
															d3.select(this).attr('opacity', 1)
															mouse_hover(d, i, xaxisGraphOne, d['key'], d.values['fte']);
															let hovered = d['key'].replace(/\s/g, "").replace("'", '').replace("/", '')
															d3.selectAll("#" + hovered).attr('opacity', 1)
														})
														.transition()
														.duration(1000)
														.attr('x', function(d, i){return i * barspacing + padding})
												})


											svg1.append('text')
												.text('Total')
												.attr('font-weight', 'bold')
												.attr('x', width/3 + sortTextOffset + sortTextSpacing)
												.attr('y', 20)
												.attr('class', 'sortBy currentYear')
												.on('mouseover', function(d){
													d3.select(this).attr('font-weight', 'bold')
												})
												.on('mouseout', function(d){

													d3.select(this).attr('font-weight', function(){
														return alphaClicked? 'normal': 'bold';
													})
												})
												.on('click', function(){
													alphaClicked=false;

													d3.selectAll('.sortBy').attr('font-weight', 'normal')
													d3.select(this).attr('font-weight', 'bold')

													svg1.selectAll('.currentTotal')
														.sort(function(a, b){
															return b.values['fte'] - a.values['fte'];
														})
														.on('mouseover', function(d, i){
															d3.select(this).attr('opacity', 1)
															mouse_hover(d, i, xaxisGraphOne, d['key'], d.values['fte']);
															let hovered = d['key'].replace(/\s/g, "").replace("'", '').replace("/", '')
															d3.selectAll("#" + hovered).attr('opacity', 1)
														})
														.transition()
														.duration(1000)
														.attr('x', function(d, i){return i * barspacing + padding})
												})

											var totalYOffset = 15

											svg1.selectAll('.currentTotal')
												.data(datasetSort)
												.enter()
												.append('g')
												.append('rect')
												.attr('class', 'currentTotal currentYear')
												.attr('x', function(d, i){return i * barspacing + padding})
												.attr('y', function(d){return xaxisGraphOne;})
												.attr('height', 0)
												.attr('width', barwidth)
												.attr('fill', 'black')
												.attr('id', function(d){
													return d['key'].replace(/\s/g, "").replace("'", '').replace("/", '');
												})
												.attr('opacity', 0.2)
												.on('mouseover', function(d, i){
													d3.select(this).attr('opacity', 1)
													mouse_hover(d, i, xaxisGraphOne, d['key'], d.values['fte']);
													let hovered = d['key'].replace(/\s/g, "").replace("'", '').replace("/", '')
													d3.selectAll("#" + hovered).attr('opacity', 1)
												})
												.on('mouseout', function(d){
													let hovered = d['key'].replace(/\s/g, "").replace("'", '').replace("/", '')
													d3.select(this)
														.attr('opacity', 0.2)
													mouse_out();
													d3.selectAll('#' + hovered).attr('opacity', 0.2)
												})
												.on('click', function(d){
													filterAllBoolean=true;
													d3.selectAll('.viewAll').attr('font-weight', 'normal')

													let hovered = d['key'].replace(/\s/g, "").replace("'", '').replace("/", '')

													d3.selectAll('.currentTotal').attr('fill', 'black')
													d3.select(this).attr('fill', 'blue')

													d3.selectAll('.currentDelta').attr('fill', function(d){
														return d.values['delta'] > 0? 'green': 'red';
													})
													d3.selectAll('#' + hovered).attr('fill', 'blue')

													detail_graphs(d, d['key']);
												})
												.transition()
												.duration(300)
												.delay(function(d, i){return i * 25})
												.attr('y', function(d){
													return xaxisGraphOne - bar1Scale(d.values['fte']);
												})
												.attr('height', function(d){
													return bar1Scale(d.values['fte']);
												})

											var yAxisGroup = svg1.append('g')
												.attr('class', 'axis currentYear')
												.attr('transform', 'translate(' + yAxisPadding + ',0)')
												.call(yAxis1)

				
				
		}

		function delta_graph(rawData){
											var yearFiltered=rawData.filter(function(d){
												return d['year']==yearClick;
											})

											var locFiltered=yearFiltered.filter(function(d){
												return locFilterBoolean? 
													//true
													d['location']==locClick:
													//false
													true;
											})

											var progFiltered=locFiltered.filter(function(d){
												return progFilterBoolean?
													//true
													d['cluster']==clusterClick:
													//false
													true;
											})

											var studentFiltered=progFiltered.filter(function(d){
												return studentFilterBoolean?
													//true
													d['studentType']==studentClick:
													//false
													true;
											})

											var deltaData=d3.nest()
												.key(function(d){
													return d['programTitle']
												})
												.rollup(function(leaves){
													var fte=d3.sum(leaves, function(d){
														return d['delta']
													})

													return {
														'delta': fte
													}
												})
												.entries(studentFiltered)

											



											var delta_maxFTEs =d3.max(deltaData, function(d){
												return Math.abs(+d.values['delta']);
											})

											var delta_minFTEs = d3.min(deltaData, function(d){
												return Math.abs(+d.values['delta']);
											})

											if (delta_maxFTEs==undefined | delta_maxFTEs==0){
												return false;
											}

											if (yearClick=='2009-10'){
												return false;
											}

											var bar2Scale = d3.scale.linear()
												.domain([0, Math.abs(delta_maxFTEs)])
												.range([0, deltaHeight])

											var axis2Scale = d3.scale.linear()
												.domain([Math.abs(delta_maxFTEs), 0])
												.range([0, deltaHeight])

											var yAxis2 = d3.svg.axis().scale(axis2Scale).orient('left')

											var yAxisGroup = svg1.append('g')
												.attr('class', 'axis currentYear')
												.attr('transform', 'translate(' + yAxisPadding + ',' + (xaxisDeltaGraph - bar2Scale(delta_maxFTEs)) +')')
												.call(yAxis2)

											svg1.append('text')
												.text('Yearly FTE differences')
												.attr('x', width/3)
												.attr('y', xaxisDeltaGraph-bar2Scale(delta_maxFTEs)-10)
												.attr('class', 'subtitleText currentYear')


											svg1.selectAll('.currentDelta')
												.data(deltaData.sort(function(a, b){return a.values['delta'] - b.values['delta'];}))
												.enter()
												.append('g')
												.append('rect')
												.attr('class', 'currentDelta currentYear')
												.attr('x', function(d, i){return i * barspacing + padding})
												.attr('y', xaxisDeltaGraph)
												.attr('width', barwidth)
												.attr('height', 0)
												.attr('fill', function(d){
													return d.values['delta'] > 0? 'green': 'red';
												})
												.attr('opacity', 0.2)
												.attr('id', function(d){
													return d['key'].replace(/\s/g, "").replace("'", '').replace("/", '');
												})
												.on('mouseover', function(d, i){
													d3.select(this)
														.attr('opacity', 1)

													mouse_hover(d, i, xaxisDeltaGraph, d['key'], d.values['delta']);

													let hovered = d['key'].replace(/\s/g, "").replace("'", '').replace("/", '')
													d3.selectAll("#" + hovered).attr('opacity', 1)
												})
												.on('mouseout', function(d, i){

													d3.select(this).attr('opacity', 0.2)
													mouse_out();
													let hovered = d['key'].replace(/\s/g, "").replace("'", '').replace("/", '')
													d3.selectAll("#" + hovered).attr('opacity', 0.2)
												})
												.on('click', function(d){
													filterAllBoolean=true;
													d3.selectAll('.viewAll').attr('font-weight', 'normal')
													let hovered = d['key'].replace(/\s/g, "").replace("'", '').replace("/", '')

													d3.selectAll('.currentDelta').attr('fill', function(d){
														return d.values['delta'] > 0? 'green': 'red';
													})

													d3.select(this).attr('fill', 'blue')
													d3.selectAll('.currentTotal').attr('fill', 'black')
													d3.selectAll('#' + hovered).attr('fill', 'blue')


													detail_graphs(d, d['key']);
												})
												.transition()
												.duration(200)
												.delay(function(d, i){return i * 25})
												.attr('height', function(d){
													return bar2Scale(Math.abs(d.values['delta']));
												})
												.attr('y', function(d){
													return xaxisDeltaGraph - bar2Scale(Math.abs(d.values['delta']));
												})
			}




function distributionGraph(raw){
											d3.selectAll('.dist').remove()
											d3.selectAll('.studentDistribution').remove()
											d3.selectAll('.barText').remove()
											d3.selectAll('.distLine').remove()

											var distribution_height = yearGraph_xaxis

											var maxCount = d3.max(raw, function(d){return d.values['count']})

											var dist_maxFTE=d3.max(raw, function(d){return +d['key'];})

											var bar4scale=d3.scale.linear()
												.domain([0, maxCount])
												.range([0, distribution_height])

											var bar4yscale=d3.scale.linear()
												.domain([maxCount, 0])
												.range([0, distribution_height])

											var bar4yaxis=d3.svg.axis().scale(bar4yscale).orient('left')

											var bar4yline = svg2.append('g')
												.attr('class', 'dyn-axis2 sideDynamic dist')
												.attr('transform', 'translate(' + (distribution_offset) + ',' + yearGraph_topPadding + ')')
												.call(bar4yaxis)



											var bar4xscale=d3.scale.linear()
												.domain([0, dist_maxFTE> 1.1? dist_maxFTE: 1.1])
												.range([0, dist_maxFTE> 1.1? dist_maxFTE*fte_spacing: 1.1*fte_spacing])

											var bar4xaxis=d3.svg.axis().scale(bar4xscale).orient('bottom')

											var bar4xline=svg2.append('g')
												.attr('class', 'dyn-axis2 sideDynamic dist')
												.attr('transform', 'translate(' + (distribution_offset + padding - yAxisPadding) + ',' + (distribution_height+yearGraph_topPadding) + ')')
												.call(bar4xaxis.ticks(4))

											var subtitle2 = svg2.append('text')
												.text('FTE/student Distribution')
												.attr('x', distribution_offset*1.25)
												.attr('y', yearGraph_topPadding-10)
												.attr('class', 'sideSubtitleText sideDynamic dist')

											var distSorted = raw.sort(function(a, b){
												return +a['key'] - +b['key'];
											})

											var fte_mid = 1.04*fte_spacing

											svg2.append('line')
												.attr('class', 'distLine dist sideDynamic')
												.style('stroke-dasharray', ('3, 3'))
												.attr('x1', distribution_offset+padding-yAxisPadding + (fte_mid))
												.attr('y1', distribution_height+yearGraph_topPadding)
												.attr('y2', distribution_height+yearGraph_topPadding + 30)
												.attr('x2', distribution_offset+padding-yAxisPadding + (fte_mid) - 20)
												.attr('stroke-width', 1)
												.attr('stroke', 'black')

											svg2.append('line')
												.attr('class', 'distLine dist sideDynamic')
												.style('stroke-dasharray', ('3, 3'))
												.attr('x1', distribution_offset+padding-yAxisPadding + (fte_mid))
												.attr('y1', distribution_height+yearGraph_topPadding)
												.attr('y2', distribution_height+yearGraph_topPadding - distribution_height)
												.attr('x2', distribution_offset+padding-yAxisPadding + (fte_mid))
												.attr('stroke-width', 1)
												.attr('stroke', 'black')

											svg2.append('text')
												.attr('class', 'fteText dist sideDynamic')
												.attr('x', distribution_offset+padding-yAxisPadding + (fte_mid) - 75)
												.attr('y', distribution_height+yearGraph_topPadding + 37.5)
												.text('This value is equal to 1 Full-Time student within a given year')

											var distBarWidth=25

											svg2.selectAll('.studentDistribution')
															.data(distSorted)
															.enter()
															.append('g')
															.append('rect')
															.attr('class', 'studentDistribution sideDynamic dist')
															.attr('y', distribution_height+yearGraph_topPadding)
															.attr('height', 0)
															.attr('x', function(d){
																return (distribution_offset+padding-yAxisPadding) + (+d['key']*fte_spacing)
															})
															.attr('width', distBarWidth)
															.attr('opacity', 0.2)
															.on('mouseover', function(d, i){
																d3.select(this).attr('opacity', 0.4)
															})
															.on('mouseout', function(d){
																d3.select(this).attr('opacity', 0.2)
															})
															.transition()
															.duration(100)
															.delay(function(d, i){return i * 10})
															.attr('y', function(d){
																return distribution_height + yearGraph_topPadding - bar4scale(d.values['count'])
															})
															.attr('height', function(d){
																return bar4scale(d.values['count']);
															})

											var distributionTotalCount = d3.sum(distSorted, function(d){
												return d.values['count']
											})

											svg2.selectAll('.barText')
															.data(distSorted)
															.enter()
															.append('g')
															.append('text')
															.attr('class', 'barText sideDynamic dist')
															.attr('x', function(d){
																return (distribution_offset+padding-yAxisPadding) + (+d['key']*fte_spacing) + 1/8 * distBarWidth
															})
															.attr('y', function(d){
																return distribution_height + yearGraph_topPadding - bar4scale(d.values['count']/2)
															})
															.text(function(d){
																let percent=d.values['count']/distributionTotalCount
																
																return d3.format(',%')(percent) 
															})
}

function detail_graphs(d, click) {

											///////////////////
											// DETAIL GRAPHS //
											///////////////////

											d3.selectAll('.sideDynamic').remove()

											let clicked=click;

											let distFilteredData=fteData.filter(function(d){
												return filterAllBoolean? d['programTitle']==clicked: true;
											})

											let LocFilteredData=distFilteredData.filter(function(d){
												return locFilterBoolean?
													//true
													d['location']==locClick:
													//false
													true;
											})

											let filteredData=LocFilteredData.filter(function(d){
												return studentFilterBoolean?
													//true
													d['studentType']==studentClick:
													//false
													true;
											})

											var titleText = svg2.append('text')
												.text(function(){
													return clicked + (locFilterBoolean? ' - ' + locClick: '') + (studentFilterBoolean? ' - ' + studentClick: '');
												})
												.attr('x', width2/4)
												.attr('y', 20)
												.attr('class', 'sideTitleText sideDynamic')

											let filteredRollup=d3.nest()
												.key(function(d){
													return d['year'];
												})
												.rollup(function(leaves){
													var fte=d3.sum(leaves, function(d){
														return d['sumFTE']
													})

													return {
														'fte': fte
													}
												})
												.entries(filteredData)

											let yearMaxFTEs = d3.max(filteredRollup, function(d){
												return +d.values['fte'];
											})

											let baseScale = yearMaxFTEs >= 1600? 1100: 0;

											let xwidth=20
											let xspacing=xwidth+1

											

											var bar3scale = d3.scale.linear()
												.domain([baseScale, yearMaxFTEs])
												.range([0, yearGraph_xaxis])

											var xAxis3Scale = d3.scale.linear()
												.domain([2009, 2017])
												.range([0, (xspacing) * (2017-2009)])

											var yAxis3Scale = d3.scale.linear()
												.domain([yearMaxFTEs, baseScale])
												.range([0, yearGraph_xaxis])

											var xAxis3 = d3.svg.axis().scale(xAxis3Scale).orient('bottom').tickFormat(d3.format('d')).outerTickSize(0)

											var xAxis3line = svg2.append('g')
												.attr('class', 'dyn-axis sideDynamic yearAxis')
												.attr('transform', 'translate(' + (padding+0.25*xwidth) + ',' + (yearGraph_xaxis+yearGraph_topPadding) + ')')
												.call(xAxis3.ticks(4))
													.selectAll('text')
													.style('text-anchor', 'end')
													.attr('dx', '2em')
													.attr('transform', 'translate(0, 5)rotate(45)')

											var yAxis3 = d3.svg.axis().scale(yAxis3Scale).orient('left')

											var yAxis3line = svg2.append('g')
												.attr('class', 'dyn-axis sideDynamic')
												.attr('transform', 'translate(' + yAxisPadding + ',' + (yearGraph_xaxis + yearGraph_topPadding - bar3scale(yearMaxFTEs)) + ')')
												.call(yAxis3)

											var subtitle1 = svg2.append('text')
												.text('Year-by-Year FTEs')
												.attr('x', (xspacing * 8)/2)
												.attr('y', yearGraph_topPadding-10)
												.attr('class', 'sideSubtitleText sideDynamic')

											var yearLine = d3.svg.line()
												.x(function(d, i){return (d['key'].substring(0, 4)-2009) * xspacing + padding;})
												.y(function(d){return yearGraph_xaxis + yearGraph_topPadding - bar3scale(d.values['fte']);})

											var filteredSorted = filteredRollup.sort(function(a, b){
												return (a['key'].substring(0, 4)) - (b['key'].substring(0, 4))
											})

											svg2.append('path')
												.attr('class', 'yearLine sideDynamic')
												.attr('d', yearLine(filteredSorted))
												.attr('fill', 'none')
												.attr('stroke', 'black')
												.attr('stroke-width', '1px')
												.attr('opacity', 0)
												.transition()
												.duration(300)
												.attr('opacity', 1)

										
											svg2.selectAll('.yearGraph')
												.data(filteredSorted)
												.enter()
												.append('g')
												.append('circle')
												.attr('r', 5)
												.attr('class', 'yearGraph sideDynamic')
												.attr('cy', 0)
												.attr('cx', function(d, i){return (d['key'].substring(0, 4)-2009) * xspacing + padding;})
												.attr('opacity', 0.2)
												.on('mouseover', function(d){
													d3.select(this).attr('opacity', 0.4)

													var yearFTE = d3.format('.1f')(d.values['fte'])

													svg2.append('text')
														.attr('class', 'hover')
														.attr('y', yearGraph_xaxis + yearGraph_topPadding - bar3scale(yearFTE)-5)
														.attr('x', (d['key'].substring(0, 4)-2009) * xspacing + padding + 5)
														.text(yearFTE)
												})
												.on('mouseout', function(d){
													d3.select(this).attr('opacity', 0.2)

													d3.selectAll('.hover').remove()
												})
												.on('click', function(d){
													yearClick = d['key']
													
													d3.select('.years_buttons')
														.selectAll('div')
														.transition()
														.duration(500)
														.style('background', 'lightblue')

													d3.select('.years_buttons').selectAll('#y' + yearClick.replace('-', ''))
														.transition()
														.duration(500)
														.style('background', 'dodgerblue')

													current_year(fteData);
													d3.csv('fteDelta.csv', delta_graph);
												})
												.transition()
												.duration(1000)
												.delay(function(d, i){return i * 50;})
												
												.attr('cy', function(d){
													return yearGraph_xaxis + yearGraph_topPadding - bar3scale(d.values['fte']);
												})

											d3.csv('studentData4.csv', fte_distribution)

												function fte_distribution(distributionData){

													var filterOne = distributionData.filter(function(d){
														return filterAllBoolean? d['programTitle']==clicked: true;
													})

													var filterTwo = filterOne.filter(function(d){
														return locFilterBoolean?
														//true
														d['location']==locClick:
														//false
														true;
													})

													var raw = d3.nest()
																.key(function(d){return d['fte']})
																.rollup(function(leaves){
										
																	var count=d3.sum(leaves, function(d){
																		return +d['count']
																	})
																	return {
																		'count': count
																	}
																})
																.entries(filterTwo)

													distributionGraph(raw);

													let distFilterSpacing=200

													svg2.append('text')
														.attr('class', 'dyn-sortBy sideDynamic')
														.attr('x', distribution_offset+distFilterSpacing)
														.attr('y', yearGraph_topPadding-10)
														.attr('font-weight', 'bold')
														.text('Historical')
														.on('mouseover', function(d){
															d3.select(this).attr('font-weight', 'bold')
														})
														.on('mouseout', function(d){
															d3.select(this).attr('font-weight', function(){
																return contemporaryClicked? 'normal': 'bold';
															})
														})
														.on('click', function(d, i){
															contemporaryClicked=false;

															let rawFilter = d3.nest()
																	.key(function(d){return d['fte']})
																	.rollup(function(leaves){
																		var count=d3.sum(leaves, function(d){
																			return +d['count']
																		})

																		return {
																			'count': count
																		}
																	})
																	.entries(filterTwo)

															distributionGraph(rawFilter);

															d3.selectAll('.dyn-sortBy').attr('font-weight', 'normal')
															d3.select(this).attr('font-weight', 'bold')
														})

													svg2.append('text')
														.attr('class', 'dyn-sortBy sideDynamic')
														.attr('x', distribution_offset+distFilterSpacing+60)
														.attr('y', yearGraph_topPadding-10)
														.text('|')

											
											
													svg2.append('text')
														.attr('class', 'dyn-sortBy sideDynamic')
														.attr('x', distribution_offset+distFilterSpacing+sortTextSpacing)
														.attr('y', yearGraph_topPadding-10)
														.on('mouseover', function(d){
															d3.select(this).attr('font-weight', 'bold')
														})
														.on('mouseout', function(d){
															d3.select(this).attr('font-weight', function(){
																return contemporaryClicked? 'bold': 'normal';
															})
														})
														.text('Contemporary Only')
														.on('click', function(d, i){

															contemporaryClicked=true;

															//Sidegraph 2

															d3.selectAll('.dyn-sortBy').attr('font-weight', 'normal')
															d3.select(this).attr('font-weight', 'bold')

															let filteredValues = filterTwo.filter(function(d){
																return d['year']==yearClick
															})

															let rawFilter = d3.nest()
																	.key(function(d){return d['fte']})
																	.rollup(function(leaves){
											
																		var count=d3.sum(leaves, function(d){

																			return +d['count']


																		})

																		return {
																			'count': count
																		}
																
																	})
																	.entries(filteredValues)


															distributionGraph(rawFilter);

															
														})

											}

											//filtering fte/student distribution

											var contemporaryClicked=false;
					////////////////////////// 
					//// END DETAIL GRAPHS ///
					//////////////////////////
}
	
current_year(fteData);

d3.csv('fteDelta.csv', delta_graph)

var clusterClick='all'



//Creating clusters

var programs=[
		
		{key: 'all', value: 'View all Programs'},
		{key: 'abe', value: 'Adult Basic Education'},
		{key: 'academic', value: 'Academic'},
		{key: 'trades', value: 'Trades'},
		{key: 'health', value: 'Health'},
		{key: 'arts', value: 'Arts'},
		{key: 'ce', value: 'Continuing Education'}

];

var locations=[
		{key: 'all', value: 'View all locations'},
		{key: 'TE', value: 'Terrace'},
		{key: 'PR', value: 'Prince Rupert'},
		{key: 'HA', value: 'Hazelton'},
		{key: 'HO', value: 'Houston'},
		{key: 'SM', value: 'Smithers'},
		{key: 'RE', value: 'Regional'}
]

var years=[
		{key: '201617', value:'2016-17'},
		{key: '201516', value:'2015-16'},
		{key: '201415', value:'2014-15'},
		{key: '201314', value:'2013-14'},
		{key: '201213', value:'2012-13'},
		{key: '201112', value:'2011-12'},
		{key: '201011', value:'2010-11'},
		{key: '200910', value:'2009-10'}
]

var students=[
		{key: 'all', value: 'View all students'},
		{key: 'fn', value: 'Aboriginal Students'},
		{key: 'ie', value: 'International Students'}
]

var selectAll=[
		{key: 'View all Programs Details', value: 'all'}	
]

var initialX=75
var navY = 20
var navX= 200
var navXInitialOffset = 150
var programY=navY*2

var selectAllButton = d3.select('body')
		.append('div')
		.attr('class', 'buttons selectAll_buttons')
		.selectAll('div')
		.data(selectAll)
		.enter()
		.append('div')
		.text(function(d){return d['key']})
		.style('background', 'lightblue')
		.style('color', 'white')
		.style('font-weight', 'bold')
		.on('click', function(d){
			d3.select(this)
					.transition()
					.duration(500)
					.style('background', 'dodgerblue')

			filterAllBoolean=false;

			detail_graphs(0, 'All Years')
		})


var progButtons = d3.select('body')
		.append('div')
		.attr('class', 'buttons prog_buttons')
		.selectAll('div')
		.data(programs)
		.enter()
		.append('div')
		.text(function(d){return d['value']})
		.style('background', function(d){return clusterClick==d['key']? "dodgerblue": 'lightblue'})
		.on('click', function(d){
			d3.select('.prog_buttons')
					.selectAll('div')
					.transition()
					.duration(500)
					.style('background', 'lightblue')

			d3.select(this)
					.transition()
					.duration(500)
					.style('background', 'dodgerblue')

			d3.select('.selectAll_buttons').selectAll('div').transition().duration(500).style('background', 'lightblue')
			

			clusterClick=d['key']

			progFilterBoolean=clusterClick=='all'? false: true;

			current_year(fteData);
			d3.csv('fteDelta.csv', delta_graph);
		})

//Location Filters

var locationY=navY*3

var locationButtons =  d3.select('body')
		.append('div')
		.attr('class', 'buttons loc_buttons')
		.selectAll('div')
		.data(locations)
		.enter()
		.append('div')
		.text(function(d){return d['value']})
		.style('background', function(d){return locClick==d['key']? "dodgerblue": 'lightblue'})
		
		.on('click', function(d){
			d3.select('.loc_buttons')
					.selectAll('div')
					.transition()
					.duration(500)
					.style('background', 'lightblue')

			d3.select(this)
					.transition()
					.duration(500)
					.style('background', 'dodgerblue')

			d3.select('.selectAll_buttons').selectAll('div').transition().duration(500).style('background', 'lightblue')

			locClick=d['key']

			locFilterBoolean=locClick=='all'? false: true;

			current_year(fteData);
			d3.csv('fteDelta.csv', delta_graph);
		})

var studentY=navY*4

var studentButtons =  d3.select('body')
		.append('div')
		.attr('class', 'buttons student_buttons')
		.selectAll('div')
		.data(students)
		.enter()
		.append('div')
		.text(function(d){return d['value']})
		.style('background', function(d){return studentClick==d['key']? "dodgerblue": 'lightblue'})
		
		.on('click', function(d){
			d3.select('.student_buttons')
					.selectAll('div')
					.transition()
					.duration(500)
					.style('background', 'lightblue')

			d3.select(this)
					.transition()
					.duration(500)
					.style('background', 'dodgerblue')

			d3.select('.selectAll_buttons').selectAll('div').transition().duration(500).style('background', 'lightblue')

			studentClick=d['key']

			studentFilterBoolean=studentClick=='all'? false: true;

			current_year(fteData);
			d3.csv('fteDelta.csv', delta_graph);
		})


var yearCenter=0
var yearY=navY

var yearButtons =  d3.select('body')
		.append('div')
		.attr('class', 'buttons years_buttons')
		.selectAll('div')
		.data(years)
		.enter()
		.append('div')
		.attr('id', function(d){return 'y' + d['key'];})
		.text(function(d){return d['value']})
		.style('background', function(d){return yearClick==d['value']? "dodgerblue": 'lightblue'})
		.on('click', function(d){
			d3.select('.years_buttons')
				.selectAll('div')
				.transition()
				.duration(500)
				.style('background', 'lightblue')

			d3.select(this)
				.transition()
				.duration(500)
				.style('background', 'dodgerblue')

			d3.select('.selectAll_buttons').selectAll('div').transition().duration(500).style('background', 'lightblue')

			yearClick=d['value']

			
			current_year(fteData);
			d3.csv('fteDelta.csv', delta_graph);
		})


///creating rectangles for backgrounds


}
	</script>
</head>


<body>
	<script type="text/javascript">
		d3.csv("fteDataClean.csv", graph); 
	</script>
</body>
</html>